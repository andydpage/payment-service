template:
    name: Template_Example
    identifier: Template_Example
    versionLabel: "1"
    type: Stage
    projectIdentifier: DevX_Demo
    orgIdentifier: default
    spec:
        type: Deployment
        spec:
            serviceConfig:
                serviceDefinition:
                    type: Kubernetes
                    spec:
                        manifestOverrideSets: []
                        manifests:
                            - manifest:
                                  identifier: templates
                                  type: K8sManifest
                                  spec:
                                      store:
                                          type: Github
                                          spec:
                                              connectorRef: nikpgithub
                                              gitFetchType: Branch
                                              paths:
                                                  - templates
                                              repoName: payment-service-nonprod
                                              branch: master
                                      skipResourceVersioning: false
                            - manifest:
                                  identifier: values
                                  type: Values
                                  spec:
                                      store:
                                          type: Github
                                          spec:
                                              connectorRef: nikpgithub
                                              gitFetchType: Branch
                                              paths:
                                                  - values-non-prod.yaml
                                              repoName: payment-service-nonprod
                                              branch: master
                        artifacts:
                            sidecars: []
                            primary:
                                spec:
                                    connectorRef: nikpdockerhub
                                    imagePath: nikpap/payment-service
                                    tag: <+pipeline.sequenceId>
                                type: DockerRegistry
                        variables: []
                serviceRef: paymentservicesrm_dev
            infrastructure:
                environmentRef: GKEDEV
                infrastructureDefinition:
                    type: KubernetesDirect
                    spec:
                        connectorRef: nikpgkecluster
                        namespace: payment-service-dev
                        releaseName: release-1
                allowSimultaneousDeployments: true
                infrastructureKey: ""
            execution:
                steps:
                    - step:
                          type: JiraCreate
                          name: JiraCreate
                          identifier: JiraCreate
                          spec:
                              connectorRef: account.Harness_JIRA
                              projectKey: HD
                              issueType: Story
                              fields:
                                  - name: Summary
                                    value: Ticket to track deployment of <+pipeline.variables.servicename> triggered by <+pipeline.variables.seusername>
                                  - name: Description
                                    value: "triggeredBy: <+pipeline.variables.seusername> buildNumber: <+pipeline.sequenceId>"
                          timeout: 1d
                    - step:
                          name: Rollout Deployment
                          identifier: rolloutDeployment
                          type: K8sRollingDeploy
                          timeout: 10m
                          spec:
                              skipDryRun: false
                    - step:
                          type: JiraUpdate
                          name: JiraUpdate
                          identifier: JiraUpdate
                          spec:
                              connectorRef: account.Harness_JIRA
                              issueKey: <+pipeline.stages.DeployDev.spec.execution.steps.JiraCreate.issue.id>
                              transitionTo:
                                  transitionName: In Progress
                                  status: In Progress
                              fields: []
                          timeout: 1d
                rollbackSteps:
                    - step:
                          name: Rollback Rollout Deployment
                          identifier: rollbackRolloutDeployment
                          type: K8sRollingRollback
                          timeout: 10m
                          spec: {}
        failureStrategies:
            - onFailure:
                  errors:
                      - AllErrors
                  action:
                      type: StageRollback
        when:
            pipelineStatus: Success
